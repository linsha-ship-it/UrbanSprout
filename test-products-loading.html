<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Loading Test</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #0056b3; }
        .product { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .price { font-weight: bold; color: green; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Products Loading Test</h1>
    <button id="testApiButton">Test Store API</button>
    <button id="testProductsButton">Test Products Display</button>
    <button id="clearButton">Clear Results</button>
    
    <div id="results"></div>
    <div id="products"></div>

    <script>
        const API_BASE_URL = 'http://localhost:5002/api';
        
        document.getElementById('testApiButton').addEventListener('click', async () => {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Loading...</p>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/store?page=1&limit=12`);
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <h3>API Response:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    <p class="${data.success ? 'success' : 'error'}">
                        ${data.success ? '✅ API call successful!' : '❌ API call failed'}
                    </p>
                    <p>Products found: ${data.data?.products?.length || 0}</p>
                `;
                
                if (data.success && data.data?.products?.length > 0) {
                    displayProducts(data.data.products);
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
            }
        });
        
        document.getElementById('testProductsButton').addEventListener('click', () => {
            const productsDiv = document.getElementById('products');
            productsDiv.innerHTML = '<h3>Testing Product Price Fields:</h3>';
            
            // Test the price field logic
            const testProduct = {
                _id: 'test123',
                name: 'Test Product',
                currentPrice: 330,
                discountPrice: 330,
                regularPrice: 382,
                price: null,
                stock: 5,
                category: 'Test Category',
                images: ['data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjQwMCIgdmlld0JveD0iMCAwIDQwMCA0MDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iNDAwIiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjIwMCIgeT0iMjAwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiM2QjcyODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIwLjNlbSI+VGVzdCBJbWFnZTwvdGV4dD4KPC9zdmc+']
            };
            
            const displayPrice = testProduct.currentPrice || testProduct.discountPrice || testProduct.regularPrice || testProduct.price || 0;
            
            productsDiv.innerHTML += `
                <div class="product">
                    <h4>${testProduct.name}</h4>
                    <p><strong>Price Fields:</strong></p>
                    <ul>
                        <li>currentPrice: ${testProduct.currentPrice}</li>
                        <li>discountPrice: ${testProduct.discountPrice}</li>
                        <li>regularPrice: ${testProduct.regularPrice}</li>
                        <li>price: ${testProduct.price}</li>
                    </ul>
                    <p class="price">Display Price: ₹${displayPrice.toLocaleString()}</p>
                    <p>Stock: ${testProduct.stock}</p>
                </div>
            `;
        });
        
        document.getElementById('clearButton').addEventListener('click', () => {
            document.getElementById('results').innerHTML = '';
            document.getElementById('products').innerHTML = '';
        });
        
        function displayProducts(products) {
            const productsDiv = document.getElementById('products');
            productsDiv.innerHTML = '<h3>Products from API:</h3>';
            
            products.forEach(product => {
                const displayPrice = product.currentPrice || product.discountPrice || product.regularPrice || product.price || 0;
                const hasDiscount = (product.currentPrice || product.discountPrice) && product.regularPrice;
                const discountPercent = hasDiscount ? Math.round(((product.regularPrice - (product.currentPrice || product.discountPrice)) / product.regularPrice) * 100) : 0;
                
                productsDiv.innerHTML += `
                    <div class="product">
                        <h4>${product.name}</h4>
                        <p><strong>Price Fields:</strong></p>
                        <ul>
                            <li>currentPrice: ${product.currentPrice || 'null'}</li>
                            <li>discountPrice: ${product.discountPrice || 'null'}</li>
                            <li>regularPrice: ${product.regularPrice || 'null'}</li>
                            <li>price: ${product.price || 'null'}</li>
                        </ul>
                        <p class="price">Display Price: ₹${displayPrice.toLocaleString()}</p>
                        ${hasDiscount ? `<p>Discount: ${discountPercent}% OFF (₹${product.regularPrice} → ₹${product.currentPrice || product.discountPrice})</p>` : ''}
                        <p>Stock: ${product.stock}</p>
                        <p>Category: ${product.category}</p>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>



